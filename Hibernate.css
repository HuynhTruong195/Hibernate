ğŸ”¸ JDBC lÃ  gÃ¬?
JDBC lÃ  má»™t API trong Java giÃºp káº¿t ná»‘i vÃ  lÃ m viá»‡c vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u (vÃ­ dá»¥: MySQL, Oracle, SQL Server...).

NÃ³ cho phÃ©p Java:

Káº¿t ná»‘i Ä‘áº¿n database

Gá»­i truy váº¥n SQL (SELECT, INSERTâ€¦)

Nháº­n vÃ  xá»­ lÃ½ káº¿t quáº£ tráº£ vá»

ğŸ”¸ CÃ¡c bÆ°á»›c sá»­ dá»¥ng JDBC cÆ¡ báº£n:

    ğŸ”¸Náº¡p driver JDBC

Class.forName("com.mysql.cj.jdbc.Driver");

    ğŸ”¸Káº¿t ná»‘i Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u

Connection conn = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/ten_database", "user", "password");

    ğŸ”¸Táº¡o Ä‘á»‘i tÆ°á»£ng truy váº¥n

Statement stmt = conn.createStatement();

    ğŸ”¸Gá»­i cÃ¢u lá»‡nh SQL vÃ  nháº­n káº¿t quáº£

ResultSet rs = stmt.executeQuery("SELECT * FROM students");

    ğŸ”¸Xá»­ lÃ½ káº¿t quáº£

while (rs.next()) {
    System.out.println(rs.getString("name"));
}

ÄÃ³ng káº¿t ná»‘i

rs.close();
stmt.close();
conn.close();

ğŸ”¸ Má»™t sá»‘ class chÃ­nh trong JDBC:
Class	Vai trÃ²
DriverManager	Quáº£n lÃ½ driver, táº¡o káº¿t ná»‘i database
Connection	Äáº¡i diá»‡n cho káº¿t ná»‘i Ä‘áº¿n CSDL
Statement	Thá»±c hiá»‡n cÃ¡c cÃ¢u lá»‡nh SQL tÄ©nh
PreparedStatement	CÃ¢u lá»‡nh SQL cÃ³ tham sá»‘, trÃ¡nh SQL injection
ResultSet	Chá»©a káº¿t quáº£ tráº£ vá» tá»« SELECT

ğŸ”¸ Gá»£i Ã½ cho ngÆ°á»i má»›i:
LuÃ´n Ä‘Ã³ng káº¿t ná»‘i sau khi dÃ¹ng.

Æ¯u tiÃªn dÃ¹ng PreparedStatement thay cho Statement.

Náº¿u dÃ¹ng MySQL: thÃªm thÆ° viá»‡n MySQL JDBC driver (file .jar) vÃ o project.


âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…

âœ… Stored Procedure lÃ  gÃ¬?
Stored Procedure (thá»§ tá»¥c lÆ°u trá»¯) lÃ  má»™t Ä‘oáº¡n mÃ£ SQL Ä‘Æ°á»£c lÆ°u sáºµn trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.
Khi cáº§n, báº¡n chá»‰ viá»‡c gá»i tÃªn thá»§ tá»¥c Ä‘Ã³ thay vÃ¬ viáº¿t láº¡i toÃ n bá»™ cÃ¢u lá»‡nh.

ğŸ“Œ NÃ³ giá»‘ng nhÆ° 1 "hÃ m" trong SQL.
âœ… Lá»£i Ã­ch:
Dá»… tÃ¡i sá»­ dá»¥ng.

Giáº£m lá»—i láº·p láº¡i code.

Cháº¡y nhanh hÆ¡n do Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch.

GiÃºp báº£o máº­t logic xá»­ lÃ½ (client khÃ´ng tháº¥y chi tiáº¿t cÃ¢u lá»‡nh SQL).

  âœ… CÃ¡ch táº¡o thá»§ tá»¥c Ä‘Æ¡n giáº£n (MySQL):

        DELIMITER //
        CREATE PROCEDURE getAllStudents()
        BEGIN
            SELECT * FROM students;
        END //
        DELIMITER ;

DÃ²ng	                        Ã nghÄ©a
DELIMITER //	        Táº¡m thá»i dÃ¹ng // thay vÃ¬ ; Ä‘á»ƒ phÃ¢n biá»‡t
END //	                Káº¿t thÃºc thá»§ tá»¥c báº±ng //
DELIMITER ;         	Äá»•i láº¡i dáº¥u ; nhÆ° bÃ¬nh thÆ°á»ng sau khi táº¡o xong



âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…

âœ… 1. JDBC lÃ  gÃ¬?
JDBC lÃ  API trong Java dÃ¹ng Ä‘á»ƒ káº¿t ná»‘i vÃ  lÃ m viá»‡c vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u (SQL).

âœ… 2. Kiáº¿n trÃºc JDBC gá»“m 2 táº§ng chÃ­nh:

[Java Application]
        â†“
[JDBC API (java.sql)]
        â†“
[JDBC Driver]
        â†“
[Database (MySQL, Oracle, v.v.)]

        âœ… Giáº£i thÃ­ch:
Táº§ng	                     Vai trÃ²
Java Application	ChÆ°Æ¡ng trÃ¬nh Java cá»§a báº¡n
JDBC API	         Cung cáº¥p cÃ¡c interface Ä‘á»ƒ báº¡n thao tÃ¡c vá»›i database
JDBC Driver	         LÃ  cáº§u ná»‘i giÃºp JDBC giao tiáº¿p vá»›i CSDL cá»¥ thá»ƒ (MySQL, Oracle, v.v.)
Database	         Há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u


âœ… 3. CÃ¡c thÃ nh pháº§n chÃ­nh trong JDBC API:
ThÃ nh pháº§n                      	Vai trÃ²	VÃ­ dá»¥
DriverManager	    Quáº£n lÃ½ driver vÃ  táº¡o káº¿t ná»‘i	DriverManager.getConnection(...)
Connection	        Äáº¡i diá»‡n cho káº¿t ná»‘i vá»›i CSDL	Connection conn = ...
Statement	        Thá»±c thi cÃ¢u SQL Ä‘Æ¡n giáº£n	stmt.executeQuery("SELECT ...")
PreparedStatement	Thá»±c thi cÃ¢u SQL cÃ³ tham sá»‘	pst.setString(1, "An");
ResultSet	        LÆ°u káº¿t quáº£ truy váº¥n SELECT	rs.next(), rs.getString(...)
SQLException	    Báº¯t lá»—i khi thao tÃ¡c DB	try { ... } catch(SQLException e) {...}

âœ… 4. 4 bÆ°á»›c chÃ­nh khi dÃ¹ng JDBC:
Náº¡p driver
    Class.forName("com.mysql.cj.jdbc.Driver");

Táº¡o káº¿t ná»‘i
    Connection conn = DriverManager.getConnection(...);

Táº¡o lá»‡nh vÃ  thá»±c thi SQL
    Statement stmt = conn.createStatement();
    ResultSet rs = stmt.executeQuery("SELECT * FROM ...");

Xá»­ lÃ½ káº¿t quáº£ vÃ  Ä‘Ã³ng káº¿t ná»‘i
    while (rs.next()) {...}
    conn.close();

âœ… TÃ³m táº¯t nhanh:
    JDBC gá»“m:

    API Ä‘á»ƒ gá»i trong Java

    Driver Ä‘á»ƒ káº¿t ná»‘i tá»›i CSDL cá»¥ thá»ƒ

    CÃ¡c lá»›p chÃ­nh: Connection, Statement, ResultSet...

    LÃ  cáº§u ná»‘i giá»¯a Java vÃ  CSDL nhÆ° MySQL, Oracle...




    ğŸ”¹ 1. Statement
DÃ¹ng Ä‘á»ƒ thá»±c thi cÃ¡c cÃ¢u SQL tÄ©nh, khÃ´ng cÃ³ tham sá»‘ (hoáº·c cÃ³ nhÆ°ng pháº£i ná»‘i chuá»—i).

KhÃ´ng báº£o vá»‡ Ä‘Æ°á»£c trÆ°á»›c SQL Injection.

Hiá»‡u suáº¥t kÃ©m hÆ¡n so vá»›i PreparedStatement vÃ¬ khÃ´ng Ä‘Æ°á»£c biÃªn dá»‹ch trÆ°á»›c.

VÃ­ dá»¥:

Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery("SELECT * FROM users WHERE age > 20");
ğŸ”¹ 2. PreparedStatement âœ… (Phá»• biáº¿n nháº¥t)
DÃ¹ng cho cÃ¡c truy váº¥n cÃ³ tham sá»‘, vÃ­ dá»¥: ? trong cÃ¢u SQL.

Báº£o máº­t hÆ¡n, trÃ¡nh Ä‘Æ°á»£c SQL Injection.

Tá»‘i Æ°u hiá»‡u nÄƒng vÃ¬ cÃ¢u lá»‡nh Ä‘Æ°á»£c biÃªn dá»‹ch sáºµn vÃ  cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng.

VÃ­ dá»¥:

PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM users WHERE age > ?");
pstmt.setInt(1, 20);
ResultSet rs = pstmt.executeQuery();
ğŸ”¹ 3. CallableStatement
DÃ¹ng Ä‘á»ƒ gá»i cÃ¡c stored procedures trong CSDL (thá»§ tá»¥c lÆ°u trá»¯).

Há»— trá»£ tham sá»‘ vÃ o, ra, vÃ  vÃ o-ra.

DÃ¹ng khi logic phá»©c táº¡p Ä‘Æ°á»£c xá»­ lÃ½ trong database qua cÃ¡c procedure.

VÃ­ dá»¥:

CallableStatement cstmt = conn.prepareCall("{call get_user_count(?)}");
cstmt.registerOutParameter(1, Types.INTEGER);
cstmt.execute();
int count = cstmt.getInt(1);


âœ… 1. CallableStatement lÃ  gÃ¬?
CallableStatement lÃ  má»™t giao diá»‡n trong JDBC dÃ¹ng Ä‘á»ƒ gá»i thá»§ tá»¥c lÆ°u trá»¯ (stored procedure) trong database.

âœ… DÃ¹ng khi logic nghiá»‡p vá»¥ (business logic) Ä‘Æ°á»£c viáº¿t sáºµn trong database (thÆ°á»ng tháº¥y trong há»‡ thá»‘ng lá»›n, hoáº·c nÆ¡i dÃ¹ng Oracle, MySQL, SQL Server, v.v.).

âœ… 3. CÃº phÃ¡p gá»i thá»§ tá»¥c vá»›i CallableStatement

USE `ecommerce`;
DELIMITER //
CREATE PROCEDURE getInsert(product_id char(5), name varchar(100), price float)
BEGIN
    INSERT into `products` (`product_id`, `name`, `price`)
        VALUES (`product_id`,`name`,`price`);
END //
DELIMITER ;


#Trong Main
     String SQL = "{CALL getInsert(?,?,?)}";

        Connection cnn = ConnectionDB.getConnection();

        try {
            CallableStatement cst = cnn.prepareCall(SQL);
            cst.setString(1, "Nam");
            cst.setString(2, "Hoang");
            cst.setFloat(3, 3000);
            int rowsInsert = cst.executeUpdate();
            System.out.println(rowsInsert);
        } catch (Exception e) {
            e.printStackTrace();
        }


Äiá»u kiá»‡n pháº£i cÃ³ class connectionDB

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class ConnectionDB {
    public static Connection getConnection() {
        try {
            // Load driver (náº¿u JDBC 4.0+ thÃ¬ dÃ²ng nÃ y cÃ³ thá»ƒ khÃ´ng cáº§n)
            Class.forName("com.mysql.cj.jdbc.Driver");

            return DriverManager.getConnection(
                    "jdbc:mysql://localhost:3306/ecommerce", // âš ï¸ Ä‘á»•i tÃªn DB tháº­t
                    "root",                                      // âš ï¸ Ä‘á»•i user tháº­t
                    "Weak"                              // âš ï¸ Ä‘á»•i máº­t kháº©u tháº­t
            );
        } catch (ClassNotFoundException | SQLException e) {
            throw new RuntimeException("âŒ Lá»—i káº¿t ná»‘i DB: " + e.getMessage(), e);
        }
    }
}


âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…âœ…

âœ… I. Tá»•ng quan vá» Transaction trong JDBC
ğŸ“Œ Transaction lÃ  gÃ¬?
LÃ  táº­p há»£p cÃ¡c thao tÃ¡c SQL Ä‘Æ°á»£c thá»±c hiá»‡n nhÆ° má»™t khá»‘i duy nháº¥t.
Náº¿u má»™t thao tÃ¡c tháº¥t báº¡i â†’ toÃ n bá»™ khá»‘i bá»‹ há»§y bá».

âœ… "Táº¥t cáº£ hoáº·c khÃ´ng gÃ¬ cáº£" â€” nguyÃªn táº¯c cá»§a transaction.

ğŸ“Œ 4 tÃ­nh cháº¥t cÆ¡ báº£n cá»§a Transaction (ACID):
TÃ­nh cháº¥t                       	Giáº£i thÃ­ch
Atomicity	    TÃ­nh nguyÃªn tá»­: táº¥t cáº£ pháº£i thÃ nh cÃ´ng hoáº·c khÃ´ng gÃ¬ cáº£
Consistency         	Dá»¯ liá»‡u luÃ´n Ä‘Ãºng tráº¡ng thÃ¡i
Isolation       	Giao dá»‹ch khÃ´ng áº£nh hÆ°á»Ÿng nhau
Durability	    Sau khi commit, dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u vÄ©nh viá»…n


âœ… II. JDBC máº·c Ä‘á»‹nh tá»± Ä‘á»™ng commit
Khi báº¡n dÃ¹ng:

Connection conn = DriverManager.getConnection(...);
// máº·c Ä‘á»‹nh: conn.setAutoCommit(true);

â†’ Má»—i executeUpdate() sáº½ tá»± commit ngay sau khi cháº¡y.

âœ… III. Quáº£n lÃ½ transaction thá»§ cÃ´ng trong JDBC
ğŸ“Œ CÃ¡c bÆ°á»›c:

    conn.setAutoCommit(false);     // 1. Táº¯t auto commit
    // Thá»±c hiá»‡n nhiá»u thao tÃ¡c SQL
    conn.commit();                 // 2. Náº¿u thÃ nh cÃ´ng â†’ commit
    conn.rollback();               // 3. Náº¿u lá»—i â†’ rollback (há»§y toÃ n bá»™)


âœ… IV. VÃ­ dá»¥ Ä‘Æ¡n giáº£n: Chuyá»ƒn tiá»n giá»¯a 2 tÃ i khoáº£n


public void transferMoney(int fromAcc, int toAcc, double amount) {
    Connection conn = ConnectionDb.getConnection();

    try {
        conn.setAutoCommit(false);  // ğŸ”´ Báº¯t Ä‘áº§u transaction

        // Trá»« tiá»n ngÆ°á»i gá»­i
        PreparedStatement ps1 = conn.prepareStatement(
            "UPDATE Account SET balance = balance - ? WHERE id = ?");
        ps1.setDouble(1, 1000);
        ps1.setInt(2, 1);
        ps1.executeUpdate();

        // Cá»™ng tiá»n ngÆ°á»i nháº­n
        PreparedStatement ps2 = conn.prepareStatement(
            "UPDATE Account SET balance = balance + ? WHERE id = ?");
        ps2.setDouble(1, 1000);
        ps2.setInt(2, 2);
        ps2.executeUpdate();

        conn.commit();  // âœ… Táº¥t cáº£ OK â†’ lÆ°u vÃ o DB
        System.out.println("ğŸ’° Giao dá»‹ch thÃ nh cÃ´ng!");

    } catch (Exception e) {
        try {
            conn.rollback();  // âŒ CÃ³ lá»—i â†’ huá»· toÃ n bá»™
            System.out.println("âŒ Giao dá»‹ch tháº¥t báº¡i, Ä‘Ã£ rollback.");
        } catch (SQLException ex) {
            ex.printStackTrace();
        }
    }
}


âœ… V. Tá»•ng káº¿t
Giai Ä‘oáº¡n	                 CÃ¢u lá»‡nh JDBC
Táº¯t auto commit	        conn.setAutoCommit(false);
Commit	             conn.commit();
Rollback	        conn.rollback();

ğŸ§  Chá»‰ cáº§n nhá»›: Táº¯t auto-commit â†’ Commit hoáº·c Rollback theo káº¿t quáº£.

âœ… CÃ¡c thao tÃ¡c chÃ­nh vá»›i Transaction trong JDBC
Thao tÃ¡c	                        Má»¥c Ä‘Ã­ch
setAutoCommit(false)	Báº¯t Ä‘áº§u má»™t transaction thá»§ cÃ´ng (JDBC máº·c Ä‘á»‹nh lÃ  true â€“ auto commit)
commit()	            XÃ¡c nháº­n vÃ  lÆ°u táº¥t cáº£ thay Ä‘á»•i vÃ o database
rollback()	            Há»§y toÃ n bá»™ thay Ä‘á»•i tá»« Ä‘áº§u transaction Ä‘áº¿n hiá»‡n táº¡i náº¿u cÃ³ lá»—i
setSavepoint()	        ÄÃ¡nh dáº¥u má»™t vá»‹ trÃ­ checkpoint trong transaction
rollback(savepoint)	    Quay vá» vá»‹ trÃ­ Ä‘Ã£ Ä‘Ã¡nh dáº¥u (khÃ´ng rollback toÃ n bá»™)
releaseSavepoint()	    Giáº£i phÃ³ng savepoint khÃ´ng dÃ¹ng ná»¯a

âœ… VÃ­ dá»¥ minh há»a Ä‘áº§y Ä‘á»§ cÃ¡c thao tÃ¡c

    Connection conn = ConnectionDb.getConnection();
try {
    conn.setAutoCommit(false); // 1. Báº¯t Ä‘áº§u transaction

    Statement st = conn.createStatement();

    st.executeUpdate("UPDATE Account SET balance = balance - 500 WHERE id = 1");
    Savepoint sp1 = conn.setSavepoint("AfterFirstUpdate"); // 2. Äáº·t checkpoint

    st.executeUpdate("UPDATE Account SET balance = balance + 500 WHERE id = 2");

    // Lá»—i giáº£ Ä‘á»‹nh
    // int error = 1 / 0;

    conn.commit(); // 3. Náº¿u khÃ´ng lá»—i â†’ commit toÃ n bá»™
    System.out.println("ğŸ’° Giao dá»‹ch thÃ nh cÃ´ng!");

} catch (Exception e) {
    try {
        conn.rollback(); // 4. Náº¿u lá»—i â†’ rollback toÃ n bá»™
        // Hoáº·c: conn.rollback(sp1); // rollback vá» checkpoint (náº¿u cáº§n)
        System.out.println("âŒ ÄÃ£ rollback giao dá»‹ch.");
    } catch (SQLException ex) {
        ex.printStackTrace();
    }
} finally {
    conn.setAutoCommit(true); // 5. LuÃ´n reset láº¡i autoCommit
}
